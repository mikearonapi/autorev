---
description: Design system, brand colors, UI components, styling rules
globs: ["**/*.jsx", "**/*.css", "**/components/**", "**/styles/**", "**/app/**/*.jsx"]
alwaysApply: false
---

# UI & DESIGN RULES

## Source of Truth

**BEFORE any UI work, read:**
1. `docs/SOURCE_OF_TRUTH.md` — **Cardinal Rule #7**: Use design tokens, NOT hardcoded colors. Also contains Component Anti-Patterns section.
2. `docs/BRAND_GUIDELINES.md` — Colors, typography, brand identity
3. `docs/CSS_ARCHITECTURE.md` — Design tokens, component patterns
4. `docs/Best Practices/Design System & Mobile-First UX.md` — Detailed patterns

## Touch Targets (NON-NEGOTIABLE)

Every interactive element MUST have a minimum **44×44px** touch target.

```jsx
// ✅ CORRECT: Icon button with proper touch target
<button className="h-11 w-11 flex items-center justify-center">
  <Icon className="h-5 w-5" />
</button>

// ✅ CORRECT: Text link with touch padding
<a className="inline-flex items-center h-11 px-2 -mx-2">
  Learn more
</a>

// ❌ WRONG: Icon button too small
<button className="p-1">
  <Icon className="h-4 w-4" />
</button>
```

**Touch Target Rules:**
- Minimum 44×44px for ALL buttons, links, and interactive elements
- 8px minimum spacing between adjacent touch targets
- Icon buttons: Use `h-11 w-11` (44px) even if icon is smaller
- Small visual elements must have expanded tap area

## Accessibility Requirements (NON-NEGOTIABLE)

| Requirement | Standard | How to Verify |
|-------------|----------|---------------|
| Text contrast | **4.5:1** minimum | Chrome DevTools color picker |
| Large text contrast | **3:1** minimum (18px+ or 14px bold) | Chrome DevTools |
| Focus indicators | **2px ring**, visible on all interactive elements | Tab through page |
| Color independence | Never rely on color alone | Test with grayscale |

```jsx
// ✅ CORRECT: Visible focus state
<button className="focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">

// ✅ CORRECT: Color + icon for status
<span className="text-teal-500"><CheckIcon /> Completed</span>

// ❌ WRONG: Color alone conveys meaning
<span className="text-red-500">Error</span>  // No icon, no context
```

## Loading States

Match loading state to expected duration:

| Duration | Pattern | Implementation |
|----------|---------|----------------|
| < 100ms | Show nothing | No loading state |
| 100-500ms | Subtle feedback | Button spinner, opacity change |
| 500ms-2s | **Skeleton screen** | Content-shaped placeholders |
| 2s-10s | Progress indicator | Show percentage if known |
| > 10s | Background process | Toast when complete |

```jsx
// ✅ CORRECT: Skeleton matches content structure
function CardSkeleton() {
  return (
    <div className="rounded-lg border p-6 space-y-4 animate-pulse">
      <div className="h-5 w-1/3 bg-muted rounded" />  {/* Title */}
      <div className="h-4 w-full bg-muted rounded" /> {/* Line 1 */}
      <div className="h-4 w-4/5 bg-muted rounded" />  {/* Line 2 */}
    </div>
  );
}

// ❌ WRONG: Generic spinner for data fetch
<div className="flex justify-center"><Spinner /></div>
```

**Skeleton Rules:**
- Shape must match actual content structure
- Minimum 300ms display (prevent flash)
- Use subtle shimmer animation (1.5-2s cycle)
- Transition smoothly to real content

## Form UX Patterns

### Input Types (Use Correct Keyboard)

| Field | Input Type | Autocomplete | Keyboard |
|-------|------------|--------------|----------|
| Email | `type="email"` | `autoComplete="email"` | Email layout |
| Phone | `type="tel"` | `autoComplete="tel"` | Number pad |
| Password | `type="password"` | `autoComplete="current-password"` | Standard |
| New password | `type="password"` | `autoComplete="new-password"` | Standard |
| Search | `type="search"` | — | Search button |
| ZIP code | `type="text" inputMode="numeric"` | `autoComplete="postal-code"` | Number pad |

```jsx
// ✅ CORRECT: Proper form field
<input
  type="email"
  inputMode="email"
  autoComplete="email"
  className="h-11"  // 44px touch target
  aria-describedby="email-error"
/>

// ❌ WRONG: Generic text for email
<input type="text" placeholder="Enter email" />
```

### Validation Timing

| Event | Action |
|-------|--------|
| On blur (leave field) | Validate completed field |
| On submit | Validate all, focus first error |
| On input (typing) | Only CLEAR existing errors |

### Form Field Height

All form inputs must be **minimum 44px (h-11)** for touch accessibility.

## Brand Colors - NEVER HARDCODE

AutoRev uses a **4-color accent system**:

| Color | Hex | CSS Variable | Purpose |
|-------|-----|--------------|---------|
| **Lime** | `#d4ff00` | `--color-accent-lime` | USER ACTIONS (CTAs, buttons) |
| **Teal** | `#10b981` | `--color-accent-teal` | POSITIVE DATA (gains, improvements) |
| **Blue** | `#3b82f6` | `--color-accent-blue` | BASELINE DATA (stock values) |
| **Amber** | `#f59e0b` | `--color-warning` | CAUTION ONLY (sparingly) |

```css
/* ❌ WRONG - hardcoded colors */
background: #d4ff00;
color: #10b981;

/* ✅ CORRECT - use CSS variables */
background: var(--color-accent-lime);
color: var(--color-accent-teal);
```

## Decision Tree: Which Color?

```
Is this a button/CTA the user clicks?
  → YES: Use LIME
  → NO: Continue...

Is this showing improved/upgraded data?
  → YES: Use TEAL
  → NO: Continue...

Is this showing original/stock data?
  → YES: Use BLUE
  → NO: Continue...

Is this a genuine warning/caution?
  → YES: Use AMBER (sparingly)
  → NO: Use white/secondary text
```

## Component Hierarchy

Before creating any UI component:

1. Check `components/ui/` for primitives (Button, Card, Input, etc.)
2. Check `components/` for composed components
3. Check `styles/components/` for shared CSS classes
4. Only create new if nothing exists

## Compose from Component Library

```css
/* In your .module.css file */
.submitButton {
  composes: btn-primary from '@/styles/components/buttons.css';
}

.vehicleCard {
  composes: card-interactive from '@/styles/components/cards.css';
}

.gainBadge {
  composes: badge-gain from '@/styles/components/badges.css';
}
```

## Available Component Classes

### Buttons (styles/components/buttons.css)
- `.btn-primary` - Lime CTAs (user actions)
- `.btn-secondary` - Outline buttons
- `.btn-teal` - Positive/success actions
- `.btn-ghost` - Minimal/tertiary
- `.btn-icon` - Icon-only buttons
- `.btn-danger` - Destructive actions

### Cards (styles/components/cards.css)
- `.card` - Base card
- `.card-interactive` - Clickable
- `.card-elevated` - With shadow
- `.card-teal` - Teal border

### Badges (styles/components/badges.css)
- `.badge-success` - Teal (completed/positive)
- `.badge-gain` - Teal for "+99" style gains
- `.badge-warning` - Amber (caution - sparingly)
- `.badge-lime` - Emphasis (premium/featured)

## Styling Rules

- Mobile-first: Start with mobile, add `md:` and `lg:` breakpoints
- Use design system spacing tokens: `--space-1` through `--space-8`
- Touch targets: Minimum 44px for buttons/links (`--touch-target-min`)
- Dark mode is default - use `--color-bg-base: #0d1b2a` backgrounds

## Stock vs Modified Comparison Pattern

```jsx
// ALWAYS use this pattern for comparisons
<span className="text-[var(--color-accent-blue)]">444 HP</span>  {/* Stock = Blue */}
<span className="text-white">→</span>
<span className="text-[var(--color-accent-teal)]">543 HP</span>  {/* Modified = Teal */}
<span className="bg-[rgba(16,185,129,0.15)] text-[var(--color-accent-teal)]">+99</span>
```

## Pre-Flight Checklist

Before submitting UI code:

| Check | Question |
|-------|----------|
| ☐ Touch targets | ALL buttons/links min 44px? |
| ☐ Accessibility | Contrast 4.5:1? Focus visible? |
| ☐ Loading states | Skeletons for data fetches? |
| ☐ Form inputs | Correct type/autocomplete? h-11 height? |
| ☐ No hardcoded colors | Using `--color-*` tokens? |
| ☐ No hardcoded spacing | Using `--space-*` tokens? |
| ☐ Component reuse | Using existing component class? |
| ☐ Mobile first | Responsive breakpoints? |

## Banned Patterns

❌ **NEVER:**
- Create touch targets smaller than 44px
- Skip focus states on interactive elements
- Use generic spinners for data loading (use skeletons)
- Use `type="text"` for email/phone/password fields
- Use `#ff6b35` (orange-red) — not in our palette
- Use gold `#d4a84b` — removed from palette
- Use pure black `#000000` for backgrounds (use `#0d1b2a`)
- Use lime for data display (use teal)
- Use amber/warning for non-warning content
- Make text smaller than 10px on mobile
- Rely on color alone to convey information
