---
description: "MANDATORY development process - read SOURCE_OF_TRUTH.md, search before creating, verify with evidence"
alwaysApply: true
---

# Mandatory Process

## ALWAYS Do These Three Things

### 1. READ SOURCE_OF_TRUTH.md FIRST
Before any code work, read `docs/SOURCE_OF_TRUTH.md`. It contains:
- 10 Cardinal Rules (violating them WILL cause bugs)
- Anti-patterns by category
- Existing service locations
- Component registry

**Output:** "üìñ Checked SOURCE_OF_TRUTH.md: [relevant rules/patterns found]"

### 2. SEARCH BEFORE CREATING
Never create new code without searching first:
- Components: `components/`
- Hooks: `hooks/`, `lib/hooks/`
- Utilities: `lib/`, `lib/*Service.js`
- API routes: `app/api/`

**Output:** "üîç Searched [location]: [found X / nothing found, creating new]"

### 3. VERIFY WITH EVIDENCE
Every task must end with proof it works:
- State success criteria
- Run verification (grep, lint, test, file check)
- Show actual output

**Output:** "‚úÖ Verified: [evidence]"

---

## Task Routing

| Task Type | Approach |
|-----------|----------|
| **Simple fix** (typo, small change) | Do it directly, verify |
| **New feature** | `@feature-workflow` |
| **Bug/debugging** | `@debug-workflow` |
| **Before shipping** | `@review-workflow` |
| **Complex/unsure** | `@tech-lead` |

---

## Cardinal Rules Quick Reference

1. **car_id for queries** - Resolve slug with `resolveCarId()` first
2. **Design tokens** - Use `var(--color-*)`, never hardcode hex
3. **Touch targets** - 44px minimum (`h-11`)
4. **Tier gating** - Respect `tierAccess` config
5. **Skeleton loaders** - Not spinners for data fetches
6. **Domain-specific names** - Not `handleClick`, `formatData`

## Key Service Files

| Need | File |
|------|------|
| Car resolution | `lib/carResolver.js` |
| Car data | `lib/carsClient.js` |
| User data | `lib/userDataService.js` |
| Performance calcs | `lib/performanceCalculator/` |
| Errors | `lib/apiErrors.js` |
| Auth | `lib/auth.js` |
